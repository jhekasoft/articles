# GUI на Golang: GTK+ 3

Решил я написать одно кроссплатформенное десктопное приложение на Go. Сделал CLI-версию, всё работает отлично.
Да ещё и кросскомпиляция в Go поддерживается. Всё в общем отлично. Но понадобилась также и GUI-версия. И тут началось...

## Выбор библиотеки (биндинга) для GUI

Приложение должно было быть кроссплатформенным.
Поэтому должно компилироваться под **Windows**, **GNU/Linux** и **macOS**.
Выбор пал на такие библиотеки:

- [gotk3](https://github.com/gotk3/gotk3) (GTK+ 3)
- [therecipe/qt](https://github.com/therecipe/qt) (Qt)
- [zserge/webview](https://github.com/zserge/webview) (нативный вебвью)

**Electron** и прочие фреймворки, которые тянут с собой Chromium и node.js я откинул так как они весят достаточно много, ещё и съедают много ресурсов операционной системы.

Теперь немного о каждой библиотеке.

### gotk3

Биндинг библиотеки **GTK+ 3**. Покрытие далеко не всех возможностей, но всё основное присутсвует.

Компилируется приложение с помощью стандартного `go build`. [Кроссплатформенная компиляция](https://github.com/gotk3/gotk3/wiki/Cross-Compiling) возможна, за исключением **macOS**. Только с **macOS** можно скомпилировать под эту ОС, ну и с **macOS** можно будет скомпилировать и под **Windows** + **GNU/Linux**.

Интерфейс будет выглядить нативно для **GNU/Linux**, **Windows** (нужно будет указать специальную тему). Для **macOS** будет выглядеть не нативно. Выкрутиться можно только разве что страшненькой темой, которая будет эмулирувать нативные элементы **macOS**.

### therecipe/qt

Биндинг библиотеки **Qt 5**. Поддержка QML, стандартных виджетов. Вообще этот биндинг многие советуют.

Компилируется с помощью специальной команды `qtdeploy`. Кроме десктопных платформ есть также и мобильные. Кросскомпиляция происходит с помощью [Docker](https://github.com/therecipe/qt/wiki/Deploying-Linux-to-Windows-64-bit-Static#using-docker-image). Под операционные системы **Apple** можно скомпилировать только с [macOS](https://github.com/therecipe/qt#deployment-targets).

При желании на **Qt** можно добиться чтобы интерфейс выглядел нативно на десктопных ОС.

### zserge/webview

Библиотека, которая написана изначально на **C**, автор прикрутил её ко многим языкам, в том числе и к **Go**. Использывается нативный [webview](https://github.com/zserge/webview#webview) для отображения: **Windows** — **MSHTML**, **GNU/Linux** — **gtk-webkit2**, **macOS** — **Cocoa/WebKit**. Кроме кода на **Go** нужно будет и на **JS** пописать, ну и **HTML** пригодится.

Компилируется при помощи `go build`, кросскомпиляция возможна с помощью [xgo](https://github.com/karalabe/xgo).

Выглядеть нативно может настолько насколько позволит стандартный браузер.

### Выбор

Почему же я выбрал именно **gotk3**?

В **therecipe/qt** мне не понравилась слишком сложная система сборки приложения, даже специальную команду сделали.

**zserge/webview** вроде бы не плох, весить будет не много, но всё-таки это **webview** и могут быть стандартные проблемы, которые бывают в таких приложениях: может что-то где-то поехать. И это не **Electron**, где всегда в комплекте продвинутый **Chromium**, а в какой-нибудь старой **Windows** может всё поехать. Да и к тому же придётся ещё и на **JS** писать.

**gotk3** я выбрал как что-то среднее. Можно собирать стандартным `go build`, выглядит приемлемо, да и вообще я **GTK+ 3** люблю!

В общем я думал, что всё будет просто. И что зря про **Go** говорят, что в нём проблема с **GUI**. Но как же я ошибался...

## Начинаем

Устанавливаем всё из **gotk3** (**gtk**, **gdk**, **glib**, **cairo**) себе:

```bash
go get github.com/gotk3/gotk3/...
```

Теперь пишем небольшой файл с кодом `main.go`:

```go
package main

import (
    "log"

    "github.com/gotk3/gotk3/gtk"
)

func main() {
    // Инициализируем GTK.
    gtk.Init(nil)

    // Создаём окно верхнего уровня, устанавливаем заголовок
    // И соединяем с сигналом "destroy" чтобы можно было закрыть
    // приложение при закрытии окна
    win, err := gtk.WindowNew(gtk.WINDOW_TOPLEVEL)
    if err != nil {
        log.Fatal("Не удалось создать окно:", err)
    }
    win.SetTitle("Простой пример")
    win.Connect("destroy", func() {
        gtk.MainQuit()
    })

    // Создаём новую метку чтобы показать её в окне
    l, err := gtk.LabelNew("Привет, gotk3!")
    if err != nil {
        log.Fatal("Не удалось создать метку:", err)
    }

    // Добавляем метку в окно
    win.Add(l)

    // Устанавливаем размер окна по умолчанию
    win.SetDefaultSize(800, 600)

    // Отображаем все виджеты в окне
    win.ShowAll()

    // Выполняем главный цикл GTK (для отрисовки). Он остановится когда
    // выполнится gtk.MainQuit()
    gtk.Main()
}
```

И выполняем его:

```bash
go run main.go
```

После запуска получим окно в виде этого:

![image](https://github.com/jhekasoft/articles/raw/master/articles/01_golang_gtk3/images/go_simple.png)

## Простой пример

## Glade

## События

## Компиляция

## Распространение

### Интеграция с ОС

### Нативные диалоги
