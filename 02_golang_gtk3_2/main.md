# GUI на Golang: GTK+ 3. Часть 2: сборка для Windows

В [1-й части](https://habr.com/post/420035/) мы рассмотрели как с помощью **gotk3** сделать простое GUI-приложение. Вроде бы всё прошло гладно. Но ведь я предупреждал, что есть нюансы с кросскомпиляцией. Да и вообще есть нюансы с распространение приложений для **Windows**, **macOS**.

Сейчас мы рассмотрим что же не так в **Windows**.

![Golang gotk3 windows](https://raw.githubusercontent.com/jhekasoft/articles/master/01_golang_gtk3/images/go_gotk3_windows.png)
<cut />

Скажу сразу, что я не хотел собирать приложение в **Windows** чтобы не разводить зоопарк окружений. Собирать **GTK+ 3** приложение в Windows [можно](https://www.gtk.org/download/windows.php). Но я не хотел настраивать ещё одно окружение в **Windows**.

В итоге у меня вышло, что **macOS**-сборка выполняется на **Macbook**'е. А сборка для **GNU/Linux** и **Windows** — на **GNU/Linux**.

## Кросскомпиляция GNU/Linux -> Windows

### Установка MinGW

[MinGW](http://www.mingw.org/) (Minimalist GNU for Windows) — это минималистичное окружение для нативных **Windows**-приложений.

Чтобы скомпилировать наше приложение по **Windows** из под **GNU/Linux** нам понадобится установить компилятор **MinGW** и **GTK+ 3** библиотеки под этот компилятор. Как это сделать описано в [вики gotk3](https://github.com/gotk3/gotk3/wiki/Cross-Compiling).

В качестве дистрибутива **GNU/Linux** я использую [Arch Linux](https://www.archlinux.org/). Отмечаю это только потому, что для него буду описывать установку библиотек. Для **Ubuntu** и вообще других дистрибутивов хотелось бы услышать советы в комментриях. Наверняка же кто-то уже компилировал **GTK+** из **GNU/Linux** -> **Windows**. Разве нет?

По счастливой случайности там это описано именно для моего любимого дистрибутива — **Arch Linux**! Когда я увидел готовые инструкции, то я обрадовался. Но не тут-то было!

Оказывается, что устанавливать все необходимые библиотеки **MinGW** нужно с пользовательсого репозитория **AUR**, они будут собираться с исходников. Сразу предупредили в вики, что процесс этот не быстрый... И вообще либ много... Даже посоветовали добавить опцию `--noconfirm` при установке, хоть это и небезопасно потому что для каждого пакета надо смотреть исходник `PKGBUILD` (кто это делает?). Плюс ещё циклические зависимости, поэтому нужно сначала ставить bootstrap-версию. В общем начинаем:

```bash
yaourt -S --asdeps --noconfirm mingw-w64-cairo-bootstrap mingw-w64-freetype2-bootstrap
```

После этого:

```bash
yaourt -S --noconfirm mingw-w64-gtk3
```

Сутки точно это всё компилировалось и ставилось. Но это нужно было сделать один раз, а дальше приложения компилировались под **Windows** как часы.

Конечно хотелось бы чтобы были уже готовые бинарники всех необходимых библиотек для **GTK+ 3** под **MinGW**, и если кто-то знает откуда их лучше взять (под последнюю версию **GTK3 +**, на данный момент это **3.22**), то конечно же пишите в комментарии.

После того как установили все библиотеки **GTK+ 3** устанавливаем сам биндинг **gotk3**:

```bash
PKG_CONFIG_PATH=/usr/x86_64-w64-mingw32/lib/pkgconfig \
CGO_ENABLED=1 \
CC=x86_64-w64-mingw32-cc \
GOOS=windows \
GOARCH=amd64 \
go install github.com/gotk3/gotk3/gtk
```

Здесь:

`PKG_CONFIG_PATH` — это путь к `pkgconfig` установленному **MinGW**.

`CGO_ENABLED=1` означает, что мы включили **CGO**, то есть язык **C** в **Go**. Это необходимо так как **GTK+ 3** и её зависимые библиотеки написаны на **C**.

`CC` — сам компилятор. **x86_64** можно заменить на **i686** если необходима 32-битная сборка вместо 64.

Про другие опции вы должны догаться сами, там всё очевидно.

### Сама кросскомпиляция

Видите, уже сколько сложностей? А всё только начинается!

Что же, приступим к самому интересному! Давайте зайдём в директорию с программой, которую мы написали в [прошлой части](https://habr.com/post/420035/#prostoe-prilozhenie-s-ispolzovaniem-glade). Можете взять её с [Github](https://github.com/jhekasoft/articles/tree/master/01_golang_gtk3/example/glade). И теперь скомпилируем программу для **Windows**:

```bash
CGO_ENABLED=1 \
CC=x86_64-w64-mingw32-cc \
GOOS=windows \
GOARCH=amd64 \
go build -ldflags -H=windowsgui
```

Для **GUI**-приложений **Windows** нужно довлять флаг `-ldflags -H=windowsgui` чтобы с ними не запускалась командная строка.

Если всё пройдёт удачно, то у нас появится файл `glade.exe`. Давайте его запустим прямо в **GNU/Linux** с помощью **wine**:

```bash
wine glade.exe
```



## Делаем GUI нативным

## Отображение изображений

## Добавляем диалог выбора файлов

## Делаем диалог нативным
