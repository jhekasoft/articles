<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>main</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="нативна-та-кросплатформова-мобільна-розробка-з-flutter">Нативна та кросплатформова мобільна розробка з Flutter</h1>
<!-- ![Test](./images/glade.png) -->
<h2 id="як-це-працює">Як це працює</h2>
<p>Колись розробка якісних мобільних додадків можлива була тільки якщо вона нативна. Тобто окремо під кожну платформу розроблявся додаток. Потім вигадали технології з додаванням вебу. Тобто додатки разроблялись за допомогою веб-технологій, а потім відображались за допомогою обгорток (wrappers) чи через WebView. Робота з API мобільних систем (камера, датчики тощо) також йшла через обгортки.</p>
<p>Потім з’явився ReactNative. Хоч UI там і нативний, але робота з ним теж через обгорти.</p>
<p>А от у фреймоврка Flutter від Google інший підхід. Там існує канвас і весь рендерінг працює через ньго. Flutter вміє рендерити як <code>Material design</code> (Android), так і <code>Cupertino</code> (iOS). Мова програмування — Dart.</p>
<p>А також з нещодавного часу на Flutter можно зробити як десктопний додаток, так і веб-додаток.</p>
<h2 id="встановлюємо-flutter">Встановлюємо Flutter</h2>
<p>Скажу одразу про моє оточення. Я буду використовувати операційну систему <code>macOS</code>, підключу <code>Android</code>-девайс та буду на ньому запускати додаток. Але можно все це робити і на інших операційних системах (<code>GNU/Linux</code>, <code>Windows</code>) та запускати на <code>iOS</code> чи взагалі на емуляторі.</p>
<p>Ще у інструкціі пропонують встановити Android Studio. Але я обійшовся без неї, мені достатньо Visual Studio Code. Якщо ви будете використовувати Android Studio (чи IntelliJ IDEA), то можете скористатися офіційними інструкціями. Посилання на них будуть далі.</p>
<h3 id="gnulinux">GNU/Linux</h3>
<p>Є сторінка з інструкцією, де треба завантажитий архів з <code>SDK</code>: https://flutter.dev/docs/get-started/install/linux.</p>
<p>Але я раджу спробувати встановити більш лінуксовим способом, тобто знайти Flutter десь у вашому репозиторію. Наприклад, у операційній системі ArchLinux Flutter є у AUR. Тому його можно встановити так:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">yaourt</span> -S flutter</a></code></pre></div>
<p>Потім ще потрібно встановити Android SDK:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">yaourt</span> -S android-sdk</a></code></pre></div>
<p>Та щей SDK конктретної платформи з інструментами:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">sdkmanager</span> <span class="st">&quot;platforms;android-28&quot;</span> <span class="st">&quot;build-tools;28.0.3&quot;</span></a></code></pre></div>
<p>Це можна зробити і пізніше коли будему запускати наш перший додаток. Все одно без цього він не запуститься, та нагадає про платформу Android та build-tools.</p>
<h3 id="macos">macOS</h3>
<p>І знову пропонують завантажити архів на офіційній сторінці: https://flutter.dev/docs/get-started/install/macos.</p>
<p>Проте якщо ви використовуюєте Homebrew, то це інсталювати можна так:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">brew</span> tap MiderWong/flutter</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="ex">brew</span> install flutter</a></code></pre></div>
<p>Ще Android SDK:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="ex">brew</span> install android-sdk</a></code></pre></div>
<p>Та платформу з build-tools:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="ex">sdkmanager</span> <span class="st">&quot;platforms;android-28&quot;</span> <span class="st">&quot;build-tools;28.0.3&quot;</span></a></code></pre></div>
<p>Ще потрібно додати змінну оточення з нашим Android SDK у файл <code>~/.bash_profile</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="bu">export</span> <span class="va">ANDROID_HOME=</span>/usr/local/share/android-sdk</a></code></pre></div>
<h3 id="windows">Windows</h3>
<p>Для Window думаю таки доведеться качати з офіційного сайту та виконувати все по інструкції: https://flutter.dev/docs/get-started/install/windows.</p>
<h2 id="налаштовуємо-ide">Налаштовуємо IDE</h2>
<p>Як я вже казав, я використовую Visual Studio Code. Для неї є <a href="https://flutter.dev/docs/get-started/editor?tab=vscode">інструкція на офіційному сайті</a>.</p>
<p>Нам доведеться встановити розширення <a href="https://marketplace.visualstudio.com/items?itemName=Dart-Code.flutter">Flutter</a>. З ним встановиться й розширення <code>Dart</code> для відповідної мови програмування.</p>
<h2 id="підключаємо-девайс">Підключаємо девайс</h2>
<p>Підключаємо за допомогою USB-кабелю. На девайсі повинен бути активований <a href="https://www.google.com/search?q=android+developer+mode">режим розробника</a>.</p>
<p>Коли підключили, то треба обрати режим <code>Передавання файлів</code>:</p>
<figure>
<img src="./images/files_mode.png" alt="Передавання файлів" /><figcaption>Передавання файлів</figcaption>
</figure>
<p>Також повинна бути увімкнена опція <code>Налогодження USB</code>:</p>
<figure>
<img src="./images/usb_debug.png" alt="Налогодження USB" /><figcaption>Налогодження USB</figcaption>
</figure>
<p>Після підключення і увімкнення необхідних опцій, можемо перевірити чи є в нас підключені девайси:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="ex">flutter</span> devices</a></code></pre></div>
<p>Якщо є, то відповідь буде схожою на цю:</p>
<pre><code>1 connected device:

FIG LX1 • XEDDU18B08001120 • android-arm64 • Android 9 (API 28)</code></pre>
<p>Далі перевіремо чи все в нас є для роботи:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="ex">flutter</span> doctor</a></code></pre></div>
<p>У відповіді можуть бути попередження:</p>
<pre><code>Doctor summary (to see all details, run flutter doctor -v):
[✓] Flutter (Channel stable, v1.5.4-hotfix.2, on Mac OS X 10.14.5 18F132, locale
    en-UA)
 
[✓] Android toolchain - develop for Android devices (Android SDK version 28.0.3)
[✗] iOS toolchain - develop for iOS devices
...
[!] Android Studio (not installed)
[✓] VS Code (version 1.35.1)
[✓] Connected device (1 available)

! Doctor found issues in 2 categories.</code></pre>
<p>Тобто в мене не має оточення для <code>iOS</code> та <code>Android Studio</code>. Для першого я поки що не збираюсь збирати додаток, а без другого обійдусь. :)</p>
<p>Якщо <code>doctor</code> буде казати про неприйняті лізензії для <code>Android</code>, то це можна зробити так:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="ex">flutter</span> doctor --android-licenses</a></code></pre></div>
<p>Доречі, ці команди вже можна буде не писати у консолі, а виконувати у IDE.</p>
<h2 id="запускаємо-наш-перший-додаток">Запускаємо наш перший додаток</h2>
<p>Щоб запустити перший додаток спочатку створимо його:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="ex">flutter</span> create flutter_demo</a></code></pre></div>
<p>Тепер в нас є проєкт <code>flutter_demo</code>. Можемо відкрити його у Visual Studio Code.</p>
<p>Переходимо у директорію з проектом якщо ще не знаходимось там:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1"><span class="bu">cd</span> flutter_demo/</a></code></pre></div>
<p>І одразу запускаємуо:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" title="1"><span class="ex">flutter</span> run</a></code></pre></div>
<p>Додаток збереться та завантажиться на девайс:</p>
<figure>
<img src="./images/first_app.png" alt="Перший додаток" /><figcaption>Перший додаток</figcaption>
</figure>
<h2 id="створюємо-свій-додаток-з-бекендом-та-rest-api">Створюємо свій додаток з бекендом та… REST API</h2>
<p>Що ж, давайте відкриємо головний файл <code>lib/main.dart</code> та подивимось що там. Так, це вже <code>Dart</code>.</p>
<p>Починається він з такого:</p>
<p>Спочатку ми імпортуємо пакет з гугловським <code>Material Design</code>. Саме звідти в нас будуть братися всї UI-віджети.</p>
<pre class="dart"><code>import &#39;package:flutter/material.dart&#39;;</code></pre>
<p>Потім в нас йде функція <code>main</code>, яка і запускає наш додаток.</p>
<pre class="dart"><code>void main() =&gt; runApp(MyApp());</code></pre>
<p>Сам клас додатка виглядає як <code>StatelessWidget</code>, у якому є початковий екран-віджет <code>MyHomePage</code>:</p>
<pre class="dart"><code>class MyApp extends StatelessWidget {
  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: &#39;Flutter Demo&#39;,
      theme: ThemeData(
        // ...
        primarySwatch: Colors.blue,
      ),
      home: MyHomePage(title: &#39;Flutter Demo Home Page&#39;),
    );
  }
}</code></pre>
<p>Взагалі, у <code>Flutter</code> є два основних типи віджетів:</p>
<ul>
<li><code>StatelessWidget</code> — віджети без стану;</li>
<li><code>StatefulWidget</code> — віджети зі станом.</li>
</ul>
<p>Наш домашній екран-віджет має стан. Бо у нього є лічильник. Тому він і має відповідний тип:</p>
<pre class="dart"><code>class MyHomePage extends StatefulWidget</code></pre>
<p>Але я пропоную поки що не розбиратись у складному віджеті і зробити для початку простий, без стану, <code>StatelessWidget</code> з текстом. Для цього прибираємо увесь код починаючи з:</p>
<pre class="dart"><code>class MyHomePage extends StatefulWidget</code></pre>
<p>І до кінця.</p>
<h2 id="початковий-екран-без-стану">Початковий екран без стану</h2>
<p>Зробимо наш початковий екран таким:</p>
<pre class="dart"><code>class MyHomePage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(&#39;Про нас&#39;),
      ),
      body: Center(
        child: Text(
            &#39;Ми робимо додаток на Flutter.&#39;,
          ),
      ),
    );
  }
}</code></pre>
<p>У методі <code>build</code> ми віддаємо наш початковий віджет у декларативному вигляді. <code>Scaffold</code> — це базовий віджет для <code>Material Design</code>. В ньому ми розташували <code>AppBar</code> (хедер) з заголовком <code>Про нас</code> та контент з текстом у центрі.</p>
<p>Також змінимо визов початкового віджету (преберемо зайвий <code>title</code>):</p>
<pre class="dart"><code>home: MyHomePage(title: &#39;Flutter Demo Home Page&#39;),</code></pre>
<p>На:</p>
<pre class="dart"><code>home: MyHomePage(),</code></pre>
<p>Тепер можемо просто оновити наш додаток (<code>Hot reload</code>) натиснувши клавішу <code>r</code> у консолі, де запускали сам додаток.</p>
<p>Побачимо:</p>
<figure>
<img src="./images/about_app.png" alt="Новий додаток" /><figcaption>Новий додаток</figcaption>
</figure>
<h2 id="бокове-меню">Бокове меню</h2>
<p>А зараз додамо гарне висувне бокове меню. У <code>Material Design</code> таке меню називається <code>Drawer</code>. Наш віджет з меню назвемо <code>DrawerMain</code>. У цьому віджету буде стан — обраний пункт меню. Тому меню матиме тип <code>StatefulWdget</code>.</p>
<p>Пишемо код:</p>
<pre class="dart"><code>class DrawerMain extends StatefulWidget {
  DrawerMain({Key key, this.selected}) : super(key: key);

  final String selected;

  @override
  DrawerMainState createState() {
    return DrawerMainState();
  }
}

class DrawerMainState extends State&lt;DrawerMain&gt; {
  @override
  Widget build (BuildContext context) {
    return Drawer(
        child: ListView(
          padding: EdgeInsets.zero,
          children: &lt;Widget&gt;[
            DrawerHeader(
              child: Text(
                  &#39;Flutter demo&#39;,
                  style: TextStyle(
                    color: Colors.white,
                    fontSize: 32.0,
                  ),
                ),
              decoration: BoxDecoration(
                color: Colors.blue,
              ),
            ),
            ListTile(
              selected: widget.selected == &#39;about&#39;,
              leading: Icon(Icons.info),
              title: Text(&#39;Про нас&#39;),
              onTap: () {
                Navigator.pop(context);
                Navigator.push(
                  context,
                  MaterialPageRoute(builder: (context) =&gt; MyHomePage()),
                );
              },
            ),
            ListTile(
              selected: widget.selected == &#39;projects&#39;,
              leading: Icon(Icons.list),
              title: Text(&#39;Проекти&#39;),
              onTap: () {
                Navigator.pop(context);
              },
            ),
          ]
        )
      );
  }
}</code></pre>
<p>І додамо сам <code>Drawer</code> до нашого початкового екрану-віджету (з вказівкою який пункт меню обраний):</p>
<pre class="dart"><code>return Scaffold(
  // ...
  drawer: DrawerMain(selected: &quot;about&quot;),
  // ...
);</code></pre>
<p>Головне тут — це те, що в нас є стан. Цей стан повертається методом <code>createState()</code>. Там знаходиться і наш віджет бокового меню. Стан нам необхідний щоб ми могли знати який пункт меню активний. В самому меню є шапка у вигляді тексту (<code>DrawerHeader</code>), та два пункти (<code>ListTile</code>): <code>Про нас</code> та <code>Проекти</code>.</p>
<p>Коли ми тапаємо (натискаємо) по пункту (<code>ListTile</code>), то виникає подія <code>onTap</code>. А вже там ми ховаємо меню:</p>
<pre class="dart"><code>Navigator.pop(context);</code></pre>
<p>Та переходимо до відповідного екрану:</p>
<pre class="dart"><code>Navigator.push(
  context,
  MaterialPageRoute(builder: (context) =&gt; MyHomePage()),
);</code></pre>
<p>Поки що екрану з проектами в нас нема, тому на нього ще зарано переходити.</p>
<p>Оновлюєм:</p>
<figure>
<img src="./images/menu_app.png" alt="Меню" /><figcaption>Меню</figcaption>
</figure>
<h2 id="отримаємо-дані-з-rest-api">Отримаємо дані з REST API</h2>
<p>Розробка повноцінного API вийде за рамки даної статті, тому я просто зробив JSON-файл і виклав його у <a href="https://raw.githubusercontent.com/jhekasoft/flutter_demo/master/fake_api/project_list.json">github-репозиторіі</a>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb28-1" title="1"><span class="ot">[</span></a>
<a class="sourceLine" id="cb28-2" title="2">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb28-3" title="3">        <span class="dt">&quot;imageUrl&quot;</span><span class="fu">:</span> <span class="st">&quot;https://raw.githubusercontent.com/jhekasoft/flutter_demo/master/fake_api/1.jpg&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb28-4" title="4">        <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Проєкт з мостом&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb28-5" title="5">        <span class="dt">&quot;shortDesc&quot;</span><span class="fu">:</span> <span class="st">&quot;Дуже цікавий проект&quot;</span></a>
<a class="sourceLine" id="cb28-6" title="6">    <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb28-7" title="7">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb28-8" title="8">        <span class="dt">&quot;imageUrl&quot;</span><span class="fu">:</span> <span class="st">&quot;https://raw.githubusercontent.com/jhekasoft/flutter_demo/master/fake_api/2.jpg&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb28-9" title="9">        <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Дерево&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb28-10" title="10">        <span class="dt">&quot;shortDesc&quot;</span><span class="fu">:</span> <span class="st">&quot;Тут дерево&quot;</span></a>
<a class="sourceLine" id="cb28-11" title="11">    <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb28-12" title="12">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb28-13" title="13">        <span class="dt">&quot;imageUrl&quot;</span><span class="fu">:</span> <span class="st">&quot;https://raw.githubusercontent.com/jhekasoft/flutter_demo/master/fake_api/3.jpg&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb28-14" title="14">        <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Птахи&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb28-15" title="15">        <span class="dt">&quot;shortDesc&quot;</span><span class="fu">:</span> <span class="st">&quot;Маленькі птахи&quot;</span></a>
<a class="sourceLine" id="cb28-16" title="16">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb28-17" title="17"><span class="ot">]</span></a></code></pre></div>
<p>У ньому знаходяться дані наших уявних проектів. Цей JSON нам треба буде розпарсити, то створюємо файл <code>lib/fetch_data/project.dart</code> з класом <code>Project</code>:</p>
<pre class="dart"><code>class Project {
  final String imageUrl;
  final String title;
  final String shortDesc;

  Project._({this.imageUrl, this.title, this.shortDesc});

  factory Project.fromJson(Map&lt;String, dynamic&gt; json) {
    return new Project._(
      imageUrl: json[&#39;imageUrl&#39;],
      title: json[&#39;title&#39;],
      shortDesc: json[&#39;shortDesc&#39;],
    );
  }
}</code></pre>
<p>Тут є необхідні поля і <code>Project.fromJson()</code> для парсингу даних.</p>
<p>Також нам знадобиться HTTP-клієнт, тому додамо його як залежність у <code>pubspec.yaml</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb30-1" title="1"><span class="fu">dependencies:</span></a>
<a class="sourceLine" id="cb30-2" title="2">  <span class="co"># ...</span></a>
<a class="sourceLine" id="cb30-3" title="3">  <span class="fu">http:</span><span class="at"> any</span></a></code></pre></div>
<p>Далі повертаємось до <code>lib/main.dart</code> та вставляємо імпортування:</p>
<pre class="dart"><code>import &#39;package:flutter_demo/fetch_data/project.dart&#39;;
import &#39;package:http/http.dart&#39; as http;
import &#39;package:flutter/scheduler.dart&#39;;
import &#39;dart:convert&#39;;</code></pre>
<p>Тобто ми іпортували наш клас <code>Project</code> для <code>JSON</code>, клас <code>HTTP</code>-клієнта та два інших, які нам знадобляться для оновлення списку та для імпорту з <code>JSON</code>.</p>
<p>Далі напишемо наш скрін-віджет з проектами:</p>
<pre class="dart"><code>class ProjectsPage extends StatefulWidget {
  @override
  _ProjectsPageState createState() =&gt; _ProjectsPageState();
}

class _ProjectsPageState extends State&lt;ProjectsPage&gt; {
  List&lt;Project&gt; list = List();
  final GlobalKey&lt;RefreshIndicatorState&gt; _refreshIndicatorKey = new GlobalKey&lt;RefreshIndicatorState&gt;();

  Future _fetchData() async {
    final response = await http.get(
      &quot;https://raw.githubusercontent.com/jhekasoft/flutter_demo/master/fake_api/project_list.json&quot;
    );
    if (response.statusCode == 200) {
      setState(() {
        list = (json.decode(response.body) as List)
          .map((data) =&gt; new Project.fromJson(data))
          .toList();
      });
    } else {
      throw Exception(&#39;Failed to load projects&#39;);
    }
  }

  @override
  void initState() {
    super.initState();
    SchedulerBinding.instance.addPostFrameCallback((_){  _refreshIndicatorKey.currentState?.show(); });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(&#39;Проекти&#39;),
      ),
      drawer: DrawerMain(selected: &quot;projects&quot;),
      body: RefreshIndicator(
        key: _refreshIndicatorKey,
        onRefresh: _fetchData,
        child: ListView.builder(
          itemCount: list.length,
          itemBuilder: (BuildContext context, int index) {
            return Card(
              child: Container(
                padding: EdgeInsets.all(16.0),
                child: Column(
                  children: &lt;Widget&gt;[
                    Image.network(
                      list[index].imageUrl,
                      fit: BoxFit.fitHeight,
                      width: 600.0,
                      height: 240.0,
                    ),
                    Text(
                      list[index].title,
                      style: TextStyle(fontSize: 14.0, fontWeight: FontWeight.bold),
                    ),
                    Text(
                      list[index].shortDesc,
                      style: TextStyle(fontSize: 11.0, fontWeight: FontWeight.normal),
                    ),
                  ],
                ),
              ),
            );
          },
        ),
      ),
    );
  }
}</code></pre>
<p>Та додамо перехід на новий екран у бокове меню <code>Drawer</code>:</p>
<pre class="dart"><code>ListTile(
  selected: widget.selected == &#39;projects&#39;,
  leading: Icon(Icons.list),
  title: Text(&#39;Проекти&#39;),
  onTap: () {
    Navigator.pop(context);
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) =&gt; ProjectsPage()),
    );
  },
),</code></pre>
<p>Так як ми додавали нову залежність, то перезапустимо проект щоб подивитись що вийшло. Але тепер зробимо це з опцією <code>--profile</code>. Так в нас буде покращена анімація у віджетах, проте оновлювати додаток швидко за допомогою клавіші <code>r</code> ми не зможемо.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb34-1" title="1"><span class="ex">flutter</span> run --profile</a></code></pre></div>
<figure>
<img src="./images/projects_app.png" alt="Проекти" /><figcaption>Проекти</figcaption>
</figure>
<p>Екран з проектами — це <code>StatefulWidget</code>, тому що в нас присутній віджет <code>RefreshIndicator</code>, для якого використовується змінна-ключ <code>_refreshIndicatorKey</code>. Цей віджет потрібен для оновлення списку з проектами. Тобто ми можемо свайпнути екран до низу, а проєкти оновляться!</p>
<figure>
<img src="./images/update_app.png" alt="Оновлення" /><figcaption>Оновлення</figcaption>
</figure>
<p>Сам список складається з карток (<code>Card</code>), в яких є зображення (<code>Image.network</code>) та текст (<code>Text</code>). І ще вони знаходяться у віджетах <code>Container</code> та <code>Column</code>. Це нам потрібно щоб зробити прийнятний зовнішній вигляд.</p>
<p>Завантаження списку відбувається у методі <code>_fetchData()</code>. Ми декодуємо отриманний <code>JSON</code> та парсимо його у список <code>list</code> з <code>Project</code>. Також оновлення змінної <code>list</code> ми робимо всередині <code>setState()</code>. Це потрібно для реактивного оновлення, що віджет-екран оновився з новими даними.</p>
<p>А коли ми тільки потрапляємо на екран <code>ProjectsPage</code>, то виконується метод <code>initState()</code>. У ньому ми змушуємо оновити список за домопогою цієї стрічки:</p>
<pre class="dart"><code>SchedulerBinding.instance.addPostFrameCallback((_){  _refreshIndicatorKey.currentState?.show(); });</code></pre>
<p>Також ви могли помітити такі речі з функціонального програмування, як тип <code>Future</code> та метод <code>map()</code>. Про них ви можете дізнатись на офіційному YouTube-каналі <code>Flutter</code>. Ось, наприклад <a href="https://www.youtube.com/watch?v=OTS-ap9_aXc">про Future</a>.</p>
<h2 id="збираємо-пакет-apk-для-android">Збираємо пакет APK для Android</h2>
<p>Обов’язково перевірте, що у файлі <code>android/app/src/main/AndroidManifest.xml</code> вказані права для доступу до інтернету:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">&lt;manifest&gt;</span></a>
<a class="sourceLine" id="cb36-2" title="2">    <span class="co">&lt;!-- ... --&gt;</span></a>
<a class="sourceLine" id="cb36-3" title="3">    <span class="kw">&lt;uses-permission</span><span class="ot"> android:name=</span><span class="st">&quot;android.permission.INTERNET&quot;</span><span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb36-4" title="4"><span class="kw">&lt;/manifest&gt;</span></a></code></pre></div>
<p>В мене чогось їх не було, тому неможливо було завантажити <code>JSON</code> з проектами.</p>
<p>А далі просто виконуйте:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb37-1" title="1"><span class="ex">flutter</span> build apk</a></code></pre></div>
<p><code>APK</code>-файл буде знаходитись тут: <code>build/app/outputs/apk/release/app-release.apk</code>. Файл в мене займає <strong>5,6 MB</strong>.</p>
<p>Взагалі є <a href="https://flutter.dev/docs/deployment/android">стаття на офіційному сайті</a> по релізу на <code>Android</code>.</p>
<h2 id="висновки">Висновки</h2>
<p>Git-репозиторій проекту, яким ми сьогодні займались знаходиться тут: https://github.com/jhekasoft/flutter_demo.</p>
<p>Я показав лише декілька екранів та бокове меню на <code>Flutter</code>. Також спробував дістати дані з мережі. І це виявилось не дуже складно. При цьому поки що я не побачив якихось складнощів.</p>
<p>Також мені сподобалась сама робота додатка. Вона досить плавна, виглядає досить нативно.</p>
<p>Сам розмір додатка поки що теж вразив. <strong>5,6 МБ</strong> — це не багато.</p>
<p>Як заявляє <code>Google</code> на <a href="https://flutter.dev/showcase">офіційному сайті</a>, <code>Flutter</code> вже використовують <code>Alibaba</code>, <code>Abbey Road Studios</code>, вони самі у додатку <code>Google Ads</code> та ща багато інших. Тому цей фреймворк чи навіть технологія здається перспективною.</p>
<p>Звісно, цікаво ще спробувати якісь більш системні речі. Наприклад, та ж камера, датчики, push-сповіщення тощо. Якщо стаття буде комусь цікава, то можливо я ще щось спробую зробити на <code>Flutter</code>. Особливо якщо будуть якісь побажання.</p>
</body>
</html>
